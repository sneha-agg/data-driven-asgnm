@using WebMatrix.Data
@{
    Layout = "_Layout";
    var db = Database.Open("BoardGame");

    var gameId = Request["id"];

    if (String.IsNullOrEmpty(gameId))
    {
        <div class="alert alert-danger text-center mt-4">Invalid Game ID.</div>;
        return;
    }

    // Main game data
    var game = db.QuerySingle("SELECT * FROM BoardGame WHERE BGGId = @0", gameId);

    if (game == null)
    {
        <div class="alert alert-warning text-center mt-4">Game not found.</div>;
        return;
    }

    // Theme
    var themeName = db.QueryValue(@"
        SELECT T.ThemeName 
        FROM GameInThemes GT
        INNER JOIN Theme T ON GT.ThemeID = T.ThemeID
        WHERE GT.BGGId = @0", gameId);

    // Family
    var familyName = db.QueryValue(@"
        SELECT F.Family 
        FROM GameFamily F
        WHERE F.FamilyCode = @0", game.FamilyCode);

    string img = String.IsNullOrWhiteSpace(game.ImagePath)
        ? "/images/noimage.png"
        : game.ImagePath;
}

<div class="container mt-5">
    <div class="card shadow rounded-3">
        <div class="row g-0">
            <div class="col-md-4">
                <img src="@img" class="img-fluid rounded-start w-100 h-100 object-cover" alt="@game.Name">
            </div>
            <div class="col-md-8">
                <div class="card-body p-4">

                    <h2 class="card-title mb-3">@game.Name</h2>

                    <p><strong>Year Published:</strong> @game.YearPublished</p>
                    <p><strong>Players:</strong> @game.MinPlayers - @game.MaxPlayers</p>

                    @if (game.MfgPlaytime != null && game.MfgPlaytime > 0)
                    {
                        <p><strong>Playtime:</strong> @game.MfgPlaytime mins</p>
                    }

                    @if (familyName != null)
                    {
                        <p><strong>Family:</strong> @familyName</p>
                    }

                    @if (themeName != null)
                    {
                        <p><strong>Theme:</strong> @themeName</p>
                    }

                    <div class="mt-3">
                        <strong>Description:</strong>
                        <p class="text-muted mt-1">@game.Description</p>
                    </div>

                    <div class="mt-4">
                        <a href="/Home/Edit?id=@gameId" class="btn btn-primary me-2"> Edit</a>
                        <a href="/Home/Delete?id=@gameId" class="btn btn-danger me-2"> Delete</a>
                        <a href="/Home/Index" class="btn btn-outline-secondary">‚Üê Back to List</a>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<style>
.object-cover {
    object-fit: cover;
}
</style>
